import ImageCanvas from"../ImageCanvas.js";import ImageSource from"./Image.js";import{containsExtent,getHeight,getWidth,scaleFromCenter}from"../extent.js";class ImageCanvasSource extends ImageSource{constructor(t){super({attributions:(t=t||{}).attributions,interpolate:t.interpolate,projection:t.projection,resolutions:t.resolutions,state:t.state}),this.canvasFunction_=t.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=void 0!==t.ratio?t.ratio:1.5}getImageInternal(t,e,i,n){e=this.findNearestResolution(e);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==e&&s.getPixelRatio()==i&&containsExtent(s.getExtent(),t))return s;t=t.slice(),scaleFromCenter(t,this.ratio_);var a=getWidth(t)/e,o=getHeight(t)/e,a=this.canvasFunction_.call(this,t,e,i,[a*i,o*i],n);return a&&(s=new ImageCanvas(t,e,i,a)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}export default ImageCanvasSource;