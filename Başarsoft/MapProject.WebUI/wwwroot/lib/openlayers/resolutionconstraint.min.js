import{clamp}from"./math.js";import{getHeight,getWidth}from"./extent.js";import{linearFindNearest}from"./array.js";function getViewportClampedResolution(t,e,o,a){var n=getWidth(e)/o[0],e=getHeight(e)/o[1];return a?Math.min(t,Math.max(n,e)):Math.min(t,Math.min(n,e))}function getSmoothClampedResolution(t,e,o){let a=Math.min(t,e);return a*=Math.log(1+50*Math.max(0,t/e-1))/50+1,o&&(a=Math.max(a,o),a/=Math.log(1+50*Math.max(0,o/t-1))/50+1),clamp(a,o/2,2*e)}function createSnapToResolutions(r,l,m,h){return l=void 0===l||l,function(t,e,o,a){if(void 0!==t){var n=r[0],i=r[r.length-1],o=m?getViewportClampedResolution(n,m,o,h):n;if(a)return l?getSmoothClampedResolution(t,o,i):clamp(t,i,o);n=Math.min(o,t),a=Math.floor(linearFindNearest(r,n,e));return r[a]>o&&a<r.length-1?r[a+1]:r[a]}}}function createSnapToPower(n,i,r,l,m,h){return l=void 0===l||l,r=void 0!==r?r:0,function(t,e,o,a){if(void 0!==t){o=m?getViewportClampedResolution(i,m,o,h):i;if(a)return l?getSmoothClampedResolution(t,o,r):clamp(t,r,o);a=Math.ceil(Math.log(i/o)/Math.log(n)-1e-9),e=-e*(.5-1e-9)+.5,t=Math.min(o,t),t=Math.floor(Math.log(i/t)/Math.log(n)+e),e=Math.max(a,t),a=i/Math.pow(n,e);return clamp(a,r,o)}}}function createMinMaxResolution(n,i,r,l,m){return r=void 0===r||r,function(t,e,o,a){if(void 0!==t)return o=l?getViewportClampedResolution(n,l,o,m):n,r&&a?getSmoothClampedResolution(t,o,i):clamp(t,i,o)}}export{createSnapToResolutions,createSnapToPower,createMinMaxResolution};