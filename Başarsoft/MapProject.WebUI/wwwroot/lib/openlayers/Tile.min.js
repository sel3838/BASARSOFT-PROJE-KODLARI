import EventTarget from"./events/Target.js";import EventType from"./events/EventType.js";import TileState from"./TileState.js";import{abstract}from"./util.js";import{easeIn}from"./easing.js";class Tile extends EventTarget{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(EventType.CHANGE)}release(){this.state===TileState.ERROR&&this.setState(TileState.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==TileState.LOADED)return this.transition_=0,t}while(t=t.interimTile);return this}refreshInterimChain(){let e=this.interimTile;if(e){let t=this;do{if(e.getState()==TileState.LOADED){e.interimTile=null;break}}while(e.getState()!=TileState.LOADING&&e.getState()==TileState.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile)}}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==TileState.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){abstract()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;t=e-i+1e3/60;return t>=this.transition_?1:easeIn(t/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}export default Tile;