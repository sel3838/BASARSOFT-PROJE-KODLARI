import CanvasBuilder from"./Builder.js";import CanvasInstruction from"./Instruction.js";import{containsCoordinate}from"../../extent.js";class CanvasImageBuilder extends CanvasBuilder{constructor(i,t,e,h){super(i,t,e,h),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(i,t,e){var h;!this.image_||this.maxExtent&&!containsCoordinate(this.maxExtent,i.getFlatCoordinates())||(this.beginGeometry(i,t,e),e=i.getFlatCoordinates(),i=i.getStride(),h=this.coordinates.length,e=this.appendFlatPointCoordinates(e,i),this.instructions.push([CanvasInstruction.DRAW_IMAGE,h,e,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,h,e,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t))}drawMultiPoint(e,i,t){if(this.image_){this.beginGeometry(e,i,t);const s=e.getFlatCoordinates(),o=[];for(let i=0,t=s.length;i<t;i+=e.getStride())this.maxExtent&&!containsCoordinate(this.maxExtent,s.slice(i,i+2))||o.push(s[i],s[i+1]);var t=this.coordinates.length,h=this.appendFlatPointCoordinates(o,2);this.instructions.push([CanvasInstruction.DRAW_IMAGE,t,h,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([CanvasInstruction.DRAW_IMAGE,t,h,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(i)}}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(i,t){var e=i.getAnchor(),h=i.getSize(),s=i.getOrigin();this.imagePixelRatio_=i.getPixelRatio(this.pixelRatio),this.anchorX_=e[0],this.anchorY_=e[1],this.hitDetectionImage_=i.getHitDetectionImage(),this.image_=i.getImage(this.pixelRatio),this.height_=h[1],this.opacity_=i.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=i.getRotateWithView(),this.rotation_=i.getRotation(),this.scale_=i.getScaleArray(),this.width_=h[0],this.declutterMode_=i.getDeclutterMode(),this.declutterImageWithText_=t}}export default CanvasImageBuilder;