import Control from"./Control.js";import EventType from"../pointer/EventType.js";import{get as getProjection,getTransformFromProjections,getUserProjection,identityTransform}from"../proj.js";import{listen}from"../events.js";import{wrapX}from"../coordinate.js";const PROJECTION="projection",COORDINATE_FORMAT="coordinateFormat";class MousePosition extends Control{constructor(t){t=t||{};const e=document.createElement("div");e.className=void 0!==t.className?t.className:"ol-mouse-position",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un,this.addChangeListener(PROJECTION,this.handleProjectionChanged_),t.coordinateFormat&&this.setCoordinateFormat(t.coordinateFormat),t.projection&&this.setProjection(t.projection),this.renderOnMouseOut_=void 0!==t.placeholder,this.placeholder_=this.renderOnMouseOut_?t.placeholder:"&#160;",this.renderedHTML_=e.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=!1!==t.wrapX}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(COORDINATE_FORMAT)}getProjection(){return this.get(PROJECTION)}handleMouseMove(t){const e=this.getMap();this.updateHTML_(e.getEventPixel(t))}handleMouseOut(t){this.updateHTML_(null)}setMap(t){super.setMap(t),t&&(t=t.getViewport(),this.listenerKeys.push(listen(t,EventType.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(listen(t,EventType.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null))}setCoordinateFormat(t){this.set(COORDINATE_FORMAT,t)}setProjection(t){this.set(PROJECTION,getProjection(t))}updateHTML_(t){let e=this.placeholder_;if(t&&this.mapProjection_){this.transform_||(o=this.getProjection(),this.transform_=o?getTransformFromProjections(this.mapProjection_,o):identityTransform);const r=this.getMap(),s=r.getCoordinateFromPixelInternal(t);if(s){var o=getUserProjection();o&&(this.transform_=getTransformFromProjections(this.mapProjection_,o)),this.transform_(s,s),this.wrapX_&&(t=o||this.getProjection()||this.mapProjection_,wrapX(s,t));const i=this.getCoordinateFormat();e=i?i(s):s.toString()}}this.renderedHTML_&&e===this.renderedHTML_||(this.element.innerHTML=e,this.renderedHTML_=e)}render(t){t=t.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}export default MousePosition;