import Interaction from"./Interaction.js";import MapBrowserEventType from"../MapBrowserEventType.js";class DblClickDragZoom extends Interaction{constructor(e){e=e||{};super(e),e.stopDown&&(this.stopDown=e.stopDown),this.scaleDeltaByPixel_=e.delta||.01,this.duration_=void 0!==e.duration?e.duration:250,this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0,this.trackedPointers_={},this.targetPointers=[]}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;var n;return this.updateTrackedPointers_(e),this.handlingDownUpSequence_?e.type==MapBrowserEventType.POINTERDRAG?(this.handleDragEvent(e),e.originalEvent.preventDefault()):e.type==MapBrowserEventType.POINTERUP&&(n=this.handleUpEvent(e),this.handlingDownUpSequence_=n):e.type==MapBrowserEventType.POINTERDOWN&&(this.handlingDoubleDownSequence_?(this.handlingDoubleDownSequence_=!1,n=this.handleDownEvent(e),this.handlingDownUpSequence_=n,t=this.stopDown(n)):(t=this.stopDown(!1),this.waitForDblTap_())),!t}handleDragEvent(e){let t=1;var n=this.targetPointers[0],i=this.down_.originalEvent,n=n.clientY-i.clientY;void 0!==this.lastDistance_&&(t=1-(this.lastDistance_-n)*this.scaleDeltaByPixel_),this.lastDistance_=n,1!=t&&(this.lastScaleDelta_=t);const o=e.map,a=o.getView();o.render(),a.adjustResolutionInternal(t)}handleDownEvent(e){if(1!=this.targetPointers.length)return!1;{const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.down_=e,this.handlingDownUpSequence_||t.getView().beginInteraction(),!0}}handleUpEvent(e){if(0!=this.targetPointers.length)return!0;{const t=e.map,n=t.getView();e=1<this.lastScaleDelta_?1:-1;return n.endInteraction(this.duration_,e),this.handlingDownUpSequence_=!1,this.handlingDoubleDownSequence_=!1}}stopDown(e){return e}updateTrackedPointers_(e){if(isPointerDraggingEvent(e)){const n=e.originalEvent;var t=n.pointerId.toString();e.type==MapBrowserEventType.POINTERUP?delete this.trackedPointers_[t]:(e.type==MapBrowserEventType.POINTERDOWN||t in this.trackedPointers_)&&(this.trackedPointers_[t]=n),this.targetPointers=Object.values(this.trackedPointers_)}}waitForDblTap_(){void 0!==this.doubleTapTimeoutId_?(clearTimeout(this.doubleTapTimeoutId_),this.doubleTapTimeoutId_=void 0):(this.handlingDoubleDownSequence_=!0,this.doubleTapTimeoutId_=setTimeout(this.endInteraction_.bind(this),250))}endInteraction_(){this.handlingDoubleDownSequence_=!1,this.doubleTapTimeoutId_=void 0}}function isPointerDraggingEvent(e){e=e.type;return e===MapBrowserEventType.POINTERDOWN||e===MapBrowserEventType.POINTERDRAG||e===MapBrowserEventType.POINTERUP}export default DblClickDragZoom;