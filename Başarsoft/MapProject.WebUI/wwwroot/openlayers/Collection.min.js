import BaseObject from"./Object.js";import CollectionEventType from"./CollectionEventType.js";import Event from"./events/Event.js";const Property={LENGTH:"length"};class CollectionEvent extends Event{constructor(t,e,r){super(t),this.element=e,this.index=r}}class Collection extends BaseObject{constructor(t,e){if(super(),this.on,this.once,this.un,this.unique_=!!(e=e||{}).unique,this.array_=t||[],this.unique_)for(let t=0,e=this.array_.length;t<e;++t)this.assertUnique_(this.array_[t],t);this.updateLength_()}clear(){for(;0<this.getLength();)this.pop()}extend(r){for(let t=0,e=r.length;t<e;++t)this.push(r[t]);return this}forEach(r){var i=this.array_;for(let t=0,e=i.length;t<e;++t)r(i[t],t,i)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Property.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(r){var i=this.array_;for(let t=0,e=i.length;t<e;++t)if(i[t]===r)return this.removeAt(t)}removeAt(t){var e;if(!(t<0||t>=this.getLength()))return e=this.array_[t],this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,e,t)),e}setAt(t,e){if(this.getLength()<=t)this.insertAt(t,e);else{if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);var r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,r,t)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,e,t))}}updateLength_(){this.set(Property.LENGTH,this.array_.length)}assertUnique_(r,i){for(let t=0,e=this.array_.length;t<e;++t)if(this.array_[t]===r&&t!==i)throw new Error("Duplicate item added to a unique collection")}}export default Collection;export{CollectionEvent};