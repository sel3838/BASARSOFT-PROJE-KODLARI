import OWS from"./OWS.js";import XML from"./XML.js";import{boundingExtent}from"../extent.js";import{makeArrayPusher,makeObjectPropertyPusher,makeObjectPropertySetter,makeStructureNS,pushParseAndPop}from"../xml.js";import{readDecimal,readPositiveInteger,readString}from"./xsd.js";import{readHref}from"./xlink.js";const NAMESPACE_URIS=[null,"http://www.opengis.net/wmts/1.0"],OWS_NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS=makeStructureNS(NAMESPACE_URIS,{Contents:makeObjectPropertySetter(readContents)});class WMTSCapabilities extends XML{constructor(){super(),this.owsParser_=new OWS}readFromNode(e){let r=e.getAttribute("version"),t=(r=r&&r.trim(),this.owsParser_.readFromNode(e));return t?(t.version=r,(t=pushParseAndPop(t,PARSERS,e,[]))||null):null}}const CONTENTS_PARSERS=makeStructureNS(NAMESPACE_URIS,{Layer:makeObjectPropertyPusher(readLayer),TileMatrixSet:makeObjectPropertyPusher(readTileMatrixSet)}),LAYER_PARSERS=makeStructureNS(NAMESPACE_URIS,{Style:makeObjectPropertyPusher(readStyle),Format:makeObjectPropertyPusher(readString),TileMatrixSetLink:makeObjectPropertyPusher(readTileMatrixSetLink),Dimension:makeObjectPropertyPusher(readDimensions),ResourceURL:makeObjectPropertyPusher(readResourceUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Abstract:makeObjectPropertySetter(readString),WGS84BoundingBox:makeObjectPropertySetter(readBoundingBox),BoundingBox:makeObjectPropertyPusher(readBoundingBoxWithCrs),Identifier:makeObjectPropertySetter(readString)})),STYLE_PARSERS=makeStructureNS(NAMESPACE_URIS,{LegendURL:makeObjectPropertyPusher(readLegendUrl)},makeStructureNS(OWS_NAMESPACE_URIS,{Title:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString)})),TMS_LINKS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixSet:makeObjectPropertySetter(readString),TileMatrixSetLimits:makeObjectPropertySetter(readTileMatrixLimitsList)}),TMS_LIMITS_LIST_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrixLimits:makeArrayPusher(readTileMatrixLimits)}),TMS_LIMITS_PARSERS=makeStructureNS(NAMESPACE_URIS,{TileMatrix:makeObjectPropertySetter(readString),MinTileRow:makeObjectPropertySetter(readPositiveInteger),MaxTileRow:makeObjectPropertySetter(readPositiveInteger),MinTileCol:makeObjectPropertySetter(readPositiveInteger),MaxTileCol:makeObjectPropertySetter(readPositiveInteger)}),DIMENSION_PARSERS=makeStructureNS(NAMESPACE_URIS,{Default:makeObjectPropertySetter(readString),Value:makeObjectPropertyPusher(readString)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)})),WGS84_BBOX_READERS=makeStructureNS(OWS_NAMESPACE_URIS,{LowerCorner:makeArrayPusher(readCoordinates),UpperCorner:makeArrayPusher(readCoordinates)}),TMS_PARSERS=makeStructureNS(NAMESPACE_URIS,{WellKnownScaleSet:makeObjectPropertySetter(readString),TileMatrix:makeObjectPropertyPusher(readTileMatrix)},makeStructureNS(OWS_NAMESPACE_URIS,{SupportedCRS:makeObjectPropertySetter(readString),Identifier:makeObjectPropertySetter(readString),BoundingBox:makeObjectPropertySetter(readBoundingBox)})),TM_PARSERS=makeStructureNS(NAMESPACE_URIS,{TopLeftCorner:makeObjectPropertySetter(readCoordinates),ScaleDenominator:makeObjectPropertySetter(readDecimal),TileWidth:makeObjectPropertySetter(readPositiveInteger),TileHeight:makeObjectPropertySetter(readPositiveInteger),MatrixWidth:makeObjectPropertySetter(readPositiveInteger),MatrixHeight:makeObjectPropertySetter(readPositiveInteger)},makeStructureNS(OWS_NAMESPACE_URIS,{Identifier:makeObjectPropertySetter(readString)}));function readContents(e,r){return pushParseAndPop({},CONTENTS_PARSERS,e,r)}function readLayer(e,r){return pushParseAndPop({},LAYER_PARSERS,e,r)}function readTileMatrixSet(e,r){return pushParseAndPop({},TMS_PARSERS,e,r)}function readStyle(e,r){const t=pushParseAndPop({},STYLE_PARSERS,e,r);if(t)return r="true"===e.getAttribute("isDefault"),t.isDefault=r,t}function readTileMatrixSetLink(e,r){return pushParseAndPop({},TMS_LINKS_PARSERS,e,r)}function readDimensions(e,r){return pushParseAndPop({},DIMENSION_PARSERS,e,r)}function readResourceUrl(e,r){var t=e.getAttribute("format"),S=e.getAttribute("template"),e=e.getAttribute("resourceType");const a={};return t&&(a.format=t),S&&(a.template=S),e&&(a.resourceType=e),a}function readBoundingBox(e,r){e=pushParseAndPop([],WGS84_BBOX_READERS,e,r);if(2==e.length)return boundingExtent(e)}function readBoundingBoxWithCrs(e,r){var t=e.getAttribute("crs"),e=pushParseAndPop([],WGS84_BBOX_READERS,e,r);if(2==e.length)return{extent:boundingExtent(e),crs:t}}function readLegendUrl(e,r){const t={};return t.format=e.getAttribute("format"),t.href=readHref(e),t}function readCoordinates(e,r){e=readString(e).split(/\s+/);if(e&&2==e.length){var t=+e[0],e=+e[1];if(!isNaN(t)&&!isNaN(e))return[t,e]}}function readTileMatrix(e,r){return pushParseAndPop({},TM_PARSERS,e,r)}function readTileMatrixLimitsList(e,r){return pushParseAndPop([],TMS_LIMITS_LIST_PARSERS,e,r)}function readTileMatrixLimits(e,r){return pushParseAndPop({},TMS_LIMITS_PARSERS,e,r)}export default WMTSCapabilities;