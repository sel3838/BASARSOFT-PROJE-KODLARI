import{lerp}from"../../math.js";import{rotate}from"./transform.js";function drawTextOnPath(r,l,n,o,f,p,i,s,h,u,m,t){let v=r[l],M=r[l+1],b=0,c=0,g=0,d=0;function x(){b=v,c=M,l+=o,v=r[l],M=r[l+1],d+=g,g=Math.sqrt((v-b)*(v-b)+(M-c)*(M-c))}for(;x(),l<n-o&&d+g<p;);for(var P=0===g?0:(p-d)/g,e=lerp(b,v,P),a=lerp(c,M,P),j=l-o,w=d,O=p+s*h(u,f,m);l<n-o&&d+g<O;)x();P=0===g?0:(O-d)/g;var T,k=lerp(b,v,P),q=lerp(c,M,P);let I;I=t?(rotate(T=[e,a,k,q],0,4,2,t,T,T),T[2]<T[0]):k<e;var y=Math.PI;const z=[];t=j+o===l;l=j,g=0,d=w,v=r[l],M=r[l+1];let A;if(t)return x(),A=Math.atan2(M-c,v-b),I&&(A+=0<A?-y:y),z[0]=[(k+e)/2,(q+a)/2,(O-p)/2,A,f],z;for(let e=0,a=(f=f.replace(/\n/g," ")).length;e<a;){x();let t=Math.atan2(M-c,v-b);if(I&&(t+=0<t?-y:y),void 0!==A){let r=t-A;if(r+=r>y?-2*y:r<-y?2*y:0,Math.abs(r)>i)return null}A=t;var B,C,D=e;let r=0;for(;e<a;++e){var E=s*h(u,f[I?a-e-1:e],m);if(l+o<n&&d+g<p+r+E/2)break;r+=E}e!==D&&(D=I?f.substring(a-D,a-e):f.substring(D,e),P=0===g?0:(p+r/2-d)/g,B=lerp(b,v,P),C=lerp(c,M,P),z.push([B,C,r/2,t,D]),p+=r)}return z}export{drawTextOnPath};