import ImageSource,{defaultImageLoadFunction}from"./Image.js";import{createLoader}from"./arcgisRest.js";import{decode}from"../Image.js";class ImageArcGISRest extends ImageSource{constructor(i){super({attributions:(i=i||{}).attributions,interpolate:i.interpolate,projection:i.projection,resolutions:i.resolutions}),this.crossOrigin_=void 0!==i.crossOrigin?i.crossOrigin:null,this.hidpi_=void 0===i.hidpi||i.hidpi,this.url_=i.url,this.imageLoadFunction_=void 0!==i.imageLoadFunction?i.imageLoadFunction:defaultImageLoadFunction,this.params_=Object.assign({},i.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=void 0!==i.ratio?i.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(i,t,e,a){return void 0===this.url_?null:(this.loader&&this.loaderProjection_===a||(this.loaderProjection_=a,this.loader=createLoader({crossOrigin:this.crossOrigin_,params:this.params_,projection:a,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(i,t)=>(this.image.setImage(i),this.imageLoadFunction_(this.image,t),decode(i))})),super.getImageInternal(i,t,e,a))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(i){this.imageLoadFunction_=i,this.changed()}setUrl(i){i!=this.url_&&(this.url_=i,this.loader=null,this.changed())}updateParams(i){Object.assign(this.params_,i),this.changed()}changed(){this.image=null,super.changed()}}export default ImageArcGISRest;