import ImageSource,{defaultImageLoadFunction}from"./Image.js";import{calculateSourceResolution}from"../reproj.js";import{createLoader,getFeatureInfoUrl,getLegendUrl}from"./wms.js";import{decode}from"../Image.js";import{get as getProjection,transform}from"../proj.js";class ImageWMS extends ImageSource{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:defaultImageLoadFunction,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,r,i){var r=getProjection(r),o=this.getProjection(),i=(o&&o!==r&&(t=calculateSourceResolution(o,r,e,t),e=transform(e,r,o)),{url:this.url_,params:{...this.params_,...i},projection:o||r});return getFeatureInfoUrl(i,e,t)}getLegendUrl(e,t){return getLegendUrl({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,r,i){return void 0===this.url_?null:(this.loader&&this.loaderProjection_===i||(this.loaderProjection_=i,this.loader=createLoader({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(e,t)=>(this.image.setImage(e),this.imageLoadFunction_(this.image,t),decode(e))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}export default ImageWMS;