import CanvasBuilder from"./Builder.js";import CanvasInstruction,{beginPathInstruction,strokeInstruction}from"./Instruction.js";import{defaultLineDash,defaultLineDashOffset}from"../canvas.js";class CanvasLineStringBuilder extends CanvasBuilder{constructor(t,i,e,s){super(t,i,e,s)}drawFlatCoordinates_(t,i,e,s){var n=this.coordinates.length,t=this.appendFlatLineCoordinates(t,i,e,s,!1,!1),i=[CanvasInstruction.MOVE_TO_LINE_TO,n,t];return this.instructions.push(i),this.hitDetectionInstructions.push(i),e}drawLineString(t,i,e){var s=this.state,n=s.strokeStyle,r=s.lineWidth;void 0!==n&&void 0!==r&&(this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,i,e),this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction),n=t.getFlatCoordinates(),r=t.getStride(),this.drawFlatCoordinates_(n,0,n.length,r),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i))}drawMultiLineString(t,i,s){var n=this.state,e=n.strokeStyle,r=n.lineWidth;if(void 0!==e&&void 0!==r){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,i,s),this.hitDetectionInstructions.push([CanvasInstruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);var o=t.getEnds(),a=t.getFlatCoordinates(),h=t.getStride();let e=0;for(let t=0,i=o.length;t<i;++t)e=this.drawFlatCoordinates_(a,e,o[t],h);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(i)}}finish(){var t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(beginPathInstruction)}}export default CanvasLineStringBuilder;